# API

## Important

* All API endpoints are prefixed with `/api/v1`.
* Requests **always** return JSON (see *Response format*).
* POST requests **require** the header `Content-Type: application/json`.

## Table of Contents

- [API](#api)
  - [Important](#important)
  - [Table of Contents](#table-of-contents)
  - [Authentication](#authentication)
    - [Authentication flow](#authentication-flow)
  - [Response format](#response-format)
- [Endpoints](#endpoints)
  - [POST `/signup`](#post-signup)
    - [Request](#request)
    - [Response](#response)
  - [POST `/signin`](#post-signin)
    - [Request](#request-1)
    - [Response](#response-1)
  - [GET `/signout`](#get-signout)
    - [Response](#response-2)
  - [GET `/account`](#get-account)
    - [Response](#response-3)

## Authentication

Most RightPay API endpoints require authentication in order to access. Authentication in RightPay is handled using session based tokens which are generated by "signing in" with an email and password, sign in should be done using native UI which in turns calls the API endpoint `/signin`. Session tokens have an infinite lifetime but can be invalidated upon the request of a user if they choose to "sign out".

Session tokens provide greater security by allowing the app and the API to only exchange sensitive user data once. It is recommended that the user password is not stored by the app and instead only stores a single session token.

Session tokens should be provided to the API by using the `Authentication` header when making a HTTP request. Tokens are to be prefixed with `Bearer `. The following request demonstrates an authenticated API request:

```
GET /api/v1/account

Authorization: Bearer e6926972a3adee17bafa260f040a43a36363407593d5aeee
Accept: application/json
User-Agent: RightPay/1.0.0
```

### Authentication flow

1. Call the sign in endpoint in order to generate a new session token:

```
POST /api/v1/signin

Accept: application/json
User-Agent: RightPay/1.0.0
Content-Type: application/json

{
    "email": "example@example.com",
    "password": "awesome_password"
}
```

2. Receive a session token:

**Server response:**
```
200 Success

{
    "success": true,
    "data": {
        "session_token": "e6926972a3adee17bafa260f040a43a36363407593d5aeee"
    }
}
```

3. Use the session token to make all subsequent requests:

```
GET /api/v1/account

Authorization: Bearer e6926972a3adee17bafa260f040a43a36363407593d5aeee
Accept: application/json
User-Agent: RightPay/1.0.0
```

**Server response:**
```
200 Success

{
    "success": true,
    "data": {
        "account": {
            "id": "3f55c059-e815-43f9-b936-0136b71a7687",
            "email": "example@example.com",
            "first_name": "First",
            "last_name": "Last",
            "date_created": "2023-10-01T22:36:03.609Z"
        }
    }
}
```

## Response format

All responses from the API are wrapped in the following JSON:

```
{
    "success": bool,
    "message": string,
    "data": object
}
```

|Key|Description|Required|
|-|-|-|
|`success`|Was the request successful.|Yes, always present in response.|
|`message`|User facing message that is always displayed on failure.|Always present for failure, never for success.|
|`data`|Data response.|No, depends on success and API endpoint.|

# Endpoints

## POST `/signup`

Sign up for an account.

### Request

|Key|Type|Description|Required|
|-|-|-|-|
|`email`|string|User's email address, used for future sign-ins.|Yes|
|`password`|string|User's password.|Yes|
|`first_name`|string|User's first name.|No|
|`last_name`|string|User's last name.|No|

### Response

|Key|Type|Description|Required|
|-|-|-|-|
|`success`|bool|Was account created.|Yes|
|`message`|string|User facing message that describes error, e.g. email already in use.|Yes, on failure.|

## POST `/signin`

Sign in to an account and generate a session token.

### Request

|Key|Type|Description|Required|
|-|-|-|-|
|`email`|string|User's email address.|Yes|
|`password`|string|User's password.|Yes|

### Response

|Key|Type|Description|Required|
|-|-|-|-|
|`success`|bool|Was sign in successful.|Yes|
|`message`|string|User facing message that describes error, e.g. incorrect details.|Yes, on failure.|
|`data.session_token`|string|New session token for user.|Yes, on success.|

## GET `/signout`

Sign out of account and invalidate session token. Requires session token (see *Authentication*).

### Response

|Key|Type|Description|Required|
|-|-|-|-|
|`success`|bool|Was sign out successful.|Yes|
|`message`|string|User facing message that describes error, e.g. server error.|Yes, on failure.|

## GET `/account`

Get signed in account details. Requires session token (see *Authentication*).

### Response

|Key|Type|Description|Required|
|-|-|-|-|
|`success`|bool|Was sign out successful.|Yes|
|`message`|string|User facing message that describes error, e.g. server error.|Yes, on failure.|
|`data.id`|string|Internal user UUIDv4 ID.|Yes|
|`data.email`|string|User's email address.|Yes|
|`data.first_name`|string|User's first name.|No|
|`data.last_name`|string|User's last name.|No|
|`data.date_created`|string<ISO8601 date>|Account creation time.|Yes|
